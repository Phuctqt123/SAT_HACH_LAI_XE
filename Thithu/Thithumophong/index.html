<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thi th·ª≠ 10 c√¢u - B√†i thi m√¥ ph·ªèng</title>
    <link rel="icon" href="../../logo_DK.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0f172a;
            --primary-light: rgb(13, 17, 24);
            --accent: #06b6d4;
            --accent-dark: #0891b2;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --text-dark: #0f172a;
            --text-light: #64748b;
            --bg-light: #f8fafc;
            --white: #ffffff;
        }

       

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }

        /* ===== HEADER ===== */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--white);
            padding: 1.5rem 2rem;
            box-shadow: 0 8px 32px rgba(15, 23, 42, 0.15);
            position: sticky;
            top: 0;
            z-index: 100;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .logo span {
            color: var(--accent);
            font-weight: 800;
            margin-left: 0.5rem;
        }

        .header-info {
            display: flex;
            gap: 2rem;
            align-items: center;
            flex: 1;
            justify-content: flex-end;
        }

        .info-box {
            background: rgba(6, 182, 212, 0.1);
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            font-size: 0.95rem;
            font-weight: 600;
        }

        .info-box strong {
            color: var(--accent);
        }

        /* ===== MAIN CONTENT ===== */
        .main-layout {
            display: flex;
            max-width: 1400px;
            margin: 2rem auto;
            gap: 2rem;
            padding: 0 1.5rem;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .exam-area {
            flex: 1;
            background: var(--white);
            padding: 2.5rem;
            border-radius: 16px;
            box-shadow: 0 20px 50px rgba(15, 23, 42, 0.1);
        }

        h1 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-size: 2rem;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .exam-subtitle {
            color: var(--text-light);
            font-size: 0.95rem;
            margin-bottom: 2rem;
            font-weight: 500;
        }

        h2 {
            font-size: 1.2rem;
            margin-bottom: 1.2rem;
            color: var(--primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        h2 i {
            color: var(--accent);
        }

        /* ===== VIDEO CONTAINER ===== */
        .video-container {
            display: flex;
            gap: 2rem;
            align-items: flex-start;
            margin: 2rem auto;
            justify-content: center;
        }

        .video-wrapper {
            flex: 1;
            max-width: 800px;
        }

        .video-controls {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            min-width: 160px;
        }

        /* ===== VIDEO PLAYER ===== */
        video {
            width: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 12px;
            height: auto;
            display: block;
            box-shadow: 0 10px 30px rgba(6, 182, 212, 0.1);
            overflow: hidden;
        }

        /* ===== TIMELINE ===== */
        .timeline-section {
            margin: 2rem 0;
        }

        .timeline-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        #timeline-wrapper {
            width: 100%;
            height: 22px;
            background: linear-gradient(90deg, #e2e8f0 0%, #cbd5e1 100%);
            position: relative;
            border-radius: 11px;
            cursor: pointer;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        #timeline-wrapper:hover {
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.15);
        }

        #timeline-progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-dark) 100%);
            border-radius: 11px;
            position: relative;
            z-index: 2;
            transition: width 0.3s ease;
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.3);
        }

        #timeline-progress.review-mode {
            opacity: 0.6;
        }

        .flag {
            position: absolute;
            top: -12px;
            width: 3px;
            height: 46px;
            background: var(--danger);
            z-index: 10;
            border-radius: 2px;
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);
        }

        .zone {
            position: absolute;
            top: 0;
            height: 100%;
            opacity: 0.8;
            z-index: 5;
        }

        .zone.s5 { background: var(--success); }
        .zone.s4 { background: #06b6d4; }
        .zone.s3 { background: #f59e0b; }
        .zone.s2 { background: #ef8135; }
        .zone.s1 { background: var(--danger); }

        /* ===== SCORE DISPLAY ===== */
        .score-container {
            display: none;
        }

        #current-score {
            font-size: 2rem;
            font-weight: 800;
            color: var(--white);
            padding: 1.5rem 2.5rem;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            border-radius: 12px;
            display: inline-block;
            min-width: 280px;
            box-shadow: 0 10px 30px rgba(6, 182, 212, 0.3);
            letter-spacing: 0.5px;
        }

        #question-progress {
            font-size: 1rem;
            color: var(--text-light);
            margin-top: 1rem;
        }

        /* ===== CONTROLS ===== */
        .controls {
            margin: 2.5rem 0;
            display: flex;
            justify-content: center;
            gap: 1.2rem;
            flex-wrap: wrap;
        }

        #nextBtn {
            width: 100%;
            justify-content: center;
        }

        #retryBtn,
        #skipBtn,
        #finishBtn {
            display: none;
        }

        .zone {
            display: none !important;
        }

        button {
            padding: 0.9rem 2rem;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
        }

        #retryBtn {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: var(--white);
        }

        #retryBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(107, 114, 128, 0.3);
        }

        #skipBtn {
            background: linear-gradient(135deg, var(--warning) 0%, #f97316 100%);
            color: var(--white);
            display: none;
        }

        #skipBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(249, 115, 22, 0.3);
        }

        #nextBtn {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            color: var(--white);
            display: none;
        }

        #nextBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(6, 182, 212, 0.3);
        }

        #finishBtn {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: var(--white);
            display: none;
        }

        #finishBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .instruction {
            margin-top: 1.5rem;
            color: var(--text-light);
            font-style: italic;
            font-size: 0.9rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 3px solid var(--accent);
            border-radius: 6px;
            text-align: left;
        }

        .instruction strong {
            color: var(--accent);
            font-weight: 600;
        }

        #footerMarker {
            height: 1px;
            width: 100%;
            margin-top: 2rem;
        }

        /* ===== RESULTS MODAL ===== */
        .results-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }

        .results-overlay.show {
            display: flex;
        }

        .results-card {
            background: var(--white);
            padding: 3rem;
            border-radius: 16px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(15, 23, 42, 0.3);
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .results-card h2 {
            margin-bottom: 1.5rem;
            display: block;
        }

        .final-score {
            font-size: 3.5rem;
            font-weight: 900;
            margin: 1.5rem 0;
            letter-spacing: -1px;
        }

        .final-score.pass {
            color: var(--success);
            text-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .final-score.fail {
            color: var(--danger);
            text-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        .result-status {
            font-size: 1.3rem;
            font-weight: 700;
            margin: 1.5rem 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
        }

        .result-status.pass {
            color: var(--success);
        }

        .result-status.fail {
            color: var(--danger);
        }

        .result-details {
            margin: 2rem 0;
            padding: 1.5rem;
            background: var(--bg-light);
            border-radius: 8px;
            text-align: left;
            font-size: 0.95rem;
        }

        .result-details div {
            margin: 0.8rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-details strong {
            color: var(--accent);
        }

        .results-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
        }

        .results-actions button {
            flex: 1;
        }

        #restartBtn {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            color: var(--white);
        }

        #restartBtn:hover {
            transform: translateY(-2px);
        }

        #exitBtn {
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
            color: var(--text-dark);
        }

        #exitBtn:hover {
            transform: translateY(-2px);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            header {
                padding: 1rem 1.5rem;
            }

            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            .header-info {
                flex-direction: column;
                gap: 1rem;
                width: 100%;
            }

            .info-box {
                width: 100%;
                text-align: center;
            }

            .main-layout {
                margin: 1rem auto;
                gap: 1rem;
                padding: 0 1rem;
            }

            .exam-area {
                padding: 1.5rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .video-container {
                flex-direction: column;
                gap: 1rem;
            }

            .video-controls {
                width: 100%;
                flex-direction: row;
                min-width: auto;
            }

            #nextBtn {
                width: auto;
            }

            video {
                min-height: 250px;
            }

            #current-score {
                font-size: 1.8rem;
                padding: 1rem 1.5rem;
                min-width: 200px;
            }

            .controls {
                gap: 0.8rem;
            }

            button {
                padding: 0.7rem 1.2rem;
                font-size: 0.85rem;
            }

            .results-card {
                padding: 2rem;
                margin: 1rem;
            }

            .final-score {
                font-size: 2.5rem;
            }
        }

        @media (max-width: 480px) {
            .results-card {
                padding: 1.5rem;
            }

            .final-score {
                font-size: 2rem;
            }
        }
         /* ===== FOOTER ===== */
        footer {
            background: linear-gradient(135deg, #0a0f1b 0%, var(--primary) 100%);
            color: var(--white);
            text-align: center;
            padding: 3rem 2rem;
            animation: slideUp 0.6s ease-out;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-icons {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            margin: 1.5rem 0;
        }

        .footer-icons a {
            color: var(--white);
            font-size: 1.5rem;
            transition: all 0.3s ease;
            text-decoration: none;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: rgba(6, 182, 212, 0.1);
        }

        .footer-icons a:hover {
            color: var(--accent);
            background: rgba(6, 182, 212, 0.2);
            transform: translateY(-3px);
        }

        footer p {
            margin: 0.5rem 0;
            opacity: 0.9;
            line-height: 1.6;
        }
        /* ===== FLOATING CONTACT ICONS ===== */
        .floating-contact {
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 999;
        }

        .contact-btn {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: var(--accent);
            color: var(--white);
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(6, 182, 212, 0.3);
            text-decoration: none;
        }

        .contact-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 32px rgba(6, 182, 212, 0.4);
            background: var(--accent-dark);
        }

        .contact-btn.facebook {
            background: #1877f2;
        }

        .contact-btn.facebook:hover {
            background: #1567d4;
        }

        .contact-btn.zalo {
            background: #0084ff;
        }

        .contact-btn.zalo:hover {
            background: #0070d4;
        }
        .tap-danger-btn {
            
            position: absolute;       /* B·∫ÆT BU·ªòC */
            z-index: 10;  
            display: block;
            margin: -3.5rem auto 0.5rem auto;
            
            padding: 1rem 1rem;
            font-size: 1rem;
            font-weight: 700;

            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;

            cursor: pointer;
            box-shadow: 0 10px 30px rgba(239,68,68,0.4);
        }
        @media (max-width: 1024px) {
            video {
                pointer-events: auto;
            }
        }
    </style>
</head>

<body>

<!-- ===== HEADER ===== -->
<header>
    <div class="header-container">
        <div class="logo">
            ƒê√†o T·∫°o L√°i Xe <span>ƒêo√†n K·∫øt</span>
        </div>
        <div class="header-info">
            <div class="info-box">
                <i class="fas fa-question-circle"></i> <strong id="question-number">C√¢u 1/10</strong>
            </div>
            <div class="info-box">
                <i class="fas fa-star"></i> <strong id="total-score">ƒêi·ªÉm: 0/50</strong>
            </div>
        </div>
    </div>
</header>
<!-- ===== FLOATING CONTACT ICONS ===== -->
<div class="floating-contact">
    <a href="https://zalo.me/0966618797" target="_blank" class="contact-btn zalo" title="Nh·∫Øn tin Zalo">
        <i class="fab fa-z"></i>
    </a>
    <a href="https://m.me/100087654321" target="_blank" class="contact-btn facebook" title="Nh·∫Øn tin Facebook">
        <i class="fab fa-facebook-f"></i>
    </a>
</div>
<!-- ===== MAIN CONTENT ===== -->
<div class="main-layout">
    <!-- KHU V·ª∞C THI -->
    <div class="exam-area" id="examArea">
        <h1><i class="fas fa-play-circle"></i> B√ÄI THI M√î PH·ªéNG - THI TH·ª¨ 10 C√ÇU</h1>
        <p class="exam-subtitle">Ph√°t hi·ªán t√¨nh hu·ªëng nguy hi·ªÉm - Ch·∫ø ƒë·ªô thi th·ª≠ ng·∫´u nhi√™n</p>

        <div class="video-container">
            <div class="video-wrapper">
                <video id="videoPlayer" muted autoplay playsinline></video>
                <video id="preloadVideo" preload="auto" muted style="display:none"></video>
                <button id="tapDangerBtn" class="tap-danger-btn">
                    üö® CH·∫†M KHI PH√ÅT HI·ªÜN NGUY HI·ªÇM
                </button>
                <p class="instruction">
                    <i class="fas fa-exclamation-circle"></i>
                    <strong>Nh·∫•n ph√≠m Space</strong> ho·∫∑c nh·∫•p v√†o <strong>n√∫t ƒê·ªè</strong> khi ph√°t hi·ªán t√¨nh hu·ªëng nguy hi·ªÉm
                </p>

                <div class="timeline-section">
                    <div class="timeline-label"><i class="fas fa-clock"></i> Ti·∫øn ƒë·ªô video</div>
                    <div id="timeline-wrapper">
                        <div id="timeline-progress"></div>
                    </div>
                </div>
            </div>

            <div class="video-controls">
                <button id="retryBtn"><i class="fas fa-redo"></i> L√†m l·∫°i</button>
                <button id="skipBtn"><i class="fas fa-check"></i> Xem k·∫øt qu·∫£</button>
                <button id="nextBtn"><i class="fas fa-arrow-right"></i> C√¢u ti·∫øp theo</button>
                <button id="finishBtn"><i class="fas fa-flag-checkered"></i> K·∫øt th√∫c</button>
            </div>
        </div>

        <div class="score-container">
            <div id="current-score"><i class="fas fa-star"></i> ƒêi·ªÉm: -</div>
            <div id="question-progress"></div>
        </div>

        

        <div id="footerMarker"></div>
    </div>
</div>

<!-- ===== RESULTS MODAL ===== -->
<div class="results-overlay" id="resultsOverlay">
    <div class="results-card">
        <h2><i class="fas fa-trophy"></i> K·∫æT QU·∫¢ B√ÄI THI</h2>
        
        <div class="final-score" id="finalScore">0</div>
        
        <div class="result-status" id="resultStatus">
            <i class="fas fa-times-circle"></i> Ch∆∞a ƒë·∫°t
        </div>

        <div class="result-details" id="resultDetails">
            <div>
                <span>T·ªïng ƒëi·ªÉm:</span>
                <strong id="resultTotalScore">0/50</strong>
            </div>
            <div>
                <span>ƒêi·ªÉm c·∫ßn ƒë·∫°t:</span>
                <strong>35 ƒëi·ªÉm</strong>
            </div>
            <div>
                <span>Tr·∫°ng th√°i:</span>
                <strong id="resultMessage">C·∫ßn √¥n t·∫≠p th√™m</strong>
            </div>
        </div>

        <div class="results-actions">
            <button id="restartBtn"><i class="fas fa-redo"></i> L√†m l·∫°i</button>
            <button id="exitBtn"><i class="fas fa-home"></i> Trang ch·ªß</button>
        </div>
    </div>
</div>
<!-- ===== FOOTER ===== -->
<footer>
    <div class="footer-content">
        <h3 style="margin-bottom: 1.5rem; font-size: 1.3rem;">ƒê√†o T·∫°o L√°i Xe <span style="color: var(--accent);">ƒêo√†n K·∫øt</span></h3>
        
        <p style="margin-bottom: 1.5rem;">
            <strong>T∆∞ v·∫•n tuy·ªÉn sinh & ƒê√†o t·∫°o l√°i xe √¥ t√¥ ‚Äì M√¥ t√¥</strong><br>
            Uy t√≠n ‚Ä¢ Nhanh ch√≥ng ‚Ä¢ H·ªó tr·ª£ t·∫≠n t√¢m
        </p>

        <div class="footer-icons">
            <a href="https://zalo.me/0966618797" target="_blank" title="Zalo">
                <i class="fab fa-z"></i>
            </a>
            <a href="https://m.me/100087654321" target="_blank" title="Facebook">
                <i class="fab fa-facebook-f"></i>
            </a>
            <a href="tel:0966618797" title="G·ªçi ƒëi·ªán">
                <i class="fas fa-phone"></i>
            </a>
        </div>

        <p style="margin-top: 2rem; font-size: 0.9rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1.5rem;">
            ¬© 2025 ƒê√†o T·∫°o L√°i Xe ƒêo√†n K·∫øt. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.<br>
            <span style="opacity: 0.8;">ƒê·ªãa ch·ªâ: TP. H·ªì Ch√≠ Minh | Hotline: 0966618797</span>
        </p>
    </div>
</footer>
<script>
    /* ================= BI·∫æN TO√ÄN C·ª§C ================= */
    let randomQuestions = [];
    let currentQuestionIndex = 0;
    let scores = {}; // L∆∞u ƒëi·ªÉm t·ª´ng c√¢u

    const video = document.getElementById("videoPlayer");
    const progress = document.getElementById("timeline-progress");
    const timeline = document.getElementById("timeline-wrapper");
    const skipBtn = document.getElementById("skipBtn");
    const nextBtn = document.getElementById("nextBtn");
    const retryBtn = document.getElementById("retryBtn");
    const finishBtn = document.getElementById("finishBtn");
    const examArea = document.getElementById("examArea");
    const footerMarker = document.getElementById("footerMarker");
    const resultsOverlay = document.getElementById("resultsOverlay");

    let flagPlaced = false;
    let flagTime = null;
    let isReviewed = false;
    let currentQuestionNumber = 0;
    
    window.addEventListener("load", () => {
            window.scrollTo({
                top: 165,   // ƒë·ªïi s·ªë n√†y theo √Ω b·∫°n
                behavior: "smooth"
            });
        });
    /* ================= D·ªÆ LI·ªÜU T√åH HU·ªêNG ================= */
    
    /* ================= T√çNH ƒêI·ªÇM ================= */
    function preloadNextQuestion() {
        const nextIndex = currentQuestionIndex + 1;
        if (nextIndex >= randomQuestions.length) return;

        const nextQuestionNumber = randomQuestions[nextIndex];
        const preloadVideo = document.getElementById("preloadVideo");

        preloadVideo.src = `video_mo_phong/${nextQuestionNumber}.webm`;
        preloadVideo.load();
    }

    function calculateScore(dangerousTimes, currentTimeMs) {
        if (!dangerousTimes) return 0;
        const t1 = parseFloat(dangerousTimes.time1) * 1000;
        const t2 = parseFloat(dangerousTimes.time2) * 1000;
        
        if (currentTimeMs < t1 || currentTimeMs > t2) return 0;

        const interval = (t2 - t1) / 5;
        const diff = currentTimeMs - t1;

        if (diff <= interval) return 5;
        if (diff <= 2 * interval) return 4;
        if (diff <= 3 * interval) return 3;
        if (diff <= 4 * interval) return 2;
        return 1;
    }

    /* ================= LOAD VIDEO ================= */
    function loadVideo(questionNumber) {
        
        const videoPlayer = document.getElementById("videoPlayer");
        videoPlayer.src = `video_mo_phong/${questionNumber}.webm`;
        videoPlayer.currentTime = 0;
        videoPlayer.load();
    }

    /* ================= RANDOM 10 C√ÇU ================= */
    function getRandomQuestions() {
        randomQuestions = [
            Math.floor(Math.random() * (15 - 1 + 1)) + 1,
            Math.floor(Math.random() * (29 - 16 + 1)) + 16,
            Math.floor(Math.random() * (43 - 30 + 1)) + 30,
            Math.floor(Math.random() * (54 - 44 + 1)) + 44,
            Math.floor(Math.random() * (63 - 55 + 1)) + 55,
            Math.floor(Math.random() * (73 - 64 + 1)) + 64,
            Math.floor(Math.random() * (81 - 74 + 1)) + 74,
            Math.floor(Math.random() * (90 - 82 + 1)) + 82,
            Math.floor(Math.random() * (105 - 91 + 1)) + 91,
            Math.floor(Math.random() * (120 - 106 + 1)) + 106
        ];

        // Kh·ªüi t·∫°o ƒëi·ªÉm cho m·ªói c√¢u
        randomQuestions.forEach(q => scores[q] = 0);

        currentQuestionIndex = 0;
        loadCurrentQuestion();
    }

    /* ================= LOAD C√ÇU HI·ªÜN T·∫†I ================= */
    function loadCurrentQuestion() {
        if (currentQuestionIndex >= randomQuestions.length) {
            showResults();
            return;
        }

        currentQuestionNumber = randomQuestions[currentQuestionIndex];

        document.getElementById("question-number").textContent =
            `C√¢u ${currentQuestionIndex + 1}/10`;
        document.getElementById("question-progress").textContent =
            `C√¢u h·ªèi s·ªë: ${currentQuestionNumber}`;

        resetUI();
        loadVideo(currentQuestionNumber);

        video.pause();
        video.currentTime = 0;

        setTimeout(() => {
            video.play().catch(() => {});
            preloadNextQuestion(); // üî• LOAD VIDEO TI·∫æP THEO ·ªû ƒê√ÇY
        }, 50);
    }


    /* ================= ƒêI·ªÄU KHI·ªÇN VIDEO ================= */
    video.addEventListener("timeupdate", () => {
        if (!video.duration || isReviewed) return;
        const percent = (video.currentTime / video.duration) * 100;
        progress.style.width = percent + "%";
    });

    /* ================= HI·ªÇN TH·ªä PH·ªî ƒêI·ªÇM ================= */
    function showReview() {
        if (isReviewed || !video.duration) return;
        isReviewed = true;
        
        video.pause();
        progress.classList.add('review-mode');
        progress.style.width = (video.currentTime / video.duration) * 100 + "%";

        const qKey = currentQuestionNumber;

        // N·∫øu ch∆∞a c√≥ ƒëi·ªÉm cho c√¢u n√†y, t√≠nh ƒëi·ªÉm m·∫∑c ƒë·ªãnh
        if (scores[qKey] === 0 && !flagPlaced) {
            scores[qKey] = 0;
            updateTotalScore();
        }

        nextBtn.style.display = "inline-flex";
        if (currentQuestionIndex === randomQuestions.length - 1) {
            finishBtn.style.display = "inline-flex";
            nextBtn.style.display = "none";
        }
        
        
    }

    /* ================= S·ª∞ KI·ªÜN ================= */
    document.addEventListener("keydown", e => {
        if (e.code !== "Space" || flagPlaced || video.paused || video.ended || isReviewed) return;
        e.preventDefault(); 

        flagPlaced = true;
        flagTime = video.currentTime;

        const percent = (flagTime / video.duration) * 100;
        const flag = document.createElement("div");
        flag.className = "flag";
        
        flag.style.left = percent + "%";
        timeline.appendChild(flag);

        const qKey = currentQuestionNumber;
        
        if (tinhhuong[qKey]) {
            const score = calculateScore(tinhhuong[qKey], flagTime * 1000);
            scores[qKey] = score;
            updateTotalScore();
        }

        if (currentQuestionIndex === randomQuestions.length - 1) {
            finishBtn.style.display = "inline-flex";
            nextBtn.style.display = "none";
        } else {
            nextBtn.style.display = "inline-flex";
        }

        
    });
    document.getElementById("tapDangerBtn")
        .addEventListener("click", () => {
            document.dispatchEvent(
                new KeyboardEvent("keydown", { code: "Space" })
            );
        });
    skipBtn.onclick = showReview;
    video.addEventListener("ended", () => {
        showReview();

        // ‚è± Sau 1.5s t·ª± chuy·ªÉn c√¢u
        setTimeout(() => {
            if (currentQuestionIndex < randomQuestions.length - 1) {
                currentQuestionIndex++;
                loadCurrentQuestion();
            } else {
                showResults();
            }
        }, 1000);
    });


    retryBtn.onclick = () => {
        loadCurrentQuestion();
    };

    nextBtn.onclick = () => {
        if (currentQuestionIndex < randomQuestions.length - 1) {
            currentQuestionIndex++;
            loadCurrentQuestion();
        }
    };

    finishBtn.onclick = () => {
        showResults();
    };

    /* ================= T√çNH T·ªîNG ƒêI·ªÇM ================= */
    function getTotalScore() {
        return Object.values(scores).reduce((sum, score) => sum + score, 0);
    }

    function updateTotalScore() {
        const total = getTotalScore();
        document.getElementById("total-score").textContent = `ƒêi·ªÉm: ${total}/50`;
    }

    /* ================= HI·ªÇN TH·ªä K·∫æT QU·∫¢ ================= */
    function showResults() {
        const totalScore = getTotalScore();
        const passed = totalScore >= 35;

        // C·∫≠p nh·∫≠t UI k·∫øt qu·∫£
        document.getElementById("finalScore").textContent = totalScore;
        document.getElementById("finalScore").className = "final-score " + (passed ? "pass" : "fail");
        
        const resultStatus = document.getElementById("resultStatus");
        resultStatus.className = "result-status " + (passed ? "pass" : "fail");
        resultStatus.innerHTML = (passed ? '<i class="fas fa-check-circle"></i> ƒê·∫†T' : '<i class="fas fa-times-circle"></i> CH∆ØA ƒê·∫†T');
        
        document.getElementById("resultTotalScore").textContent = `${totalScore}/50`;
        document.getElementById("resultMessage").textContent = passed ? "Ch√∫c m·ª´ng b·∫°n ƒë·∫°t ƒë∆∞·ª£c ƒëi·ªÉm" : "B·∫°n c·∫ßn √¥n t·∫≠p th√™m";

        resultsOverlay.classList.add("show");
    }

    /* ================= RESET UI ================= */
    function resetUI() {
        flagPlaced = false;
        flagTime = null;
        isReviewed = false;
        skipBtn.style.display = "none";
        nextBtn.style.display = "none";
        finishBtn.style.display = "none";
        document.getElementById("current-score").innerText = "ƒêi·ªÉm: -";
        progress.style.width = "0%";
        progress.classList.remove('review-mode');
        const extras = timeline.querySelectorAll('.flag, .zone');
        extras.forEach(el => el.remove());
    }

    /* ================= S·ª∞ KI·ªÜN N√öT RESULTS ================= */
    document.getElementById("restartBtn").onclick = () => {
        scores = {};
        randomQuestions = [];
        currentQuestionIndex = 0;
        resultsOverlay.classList.remove("show");
        getRandomQuestions();
    };

    document.getElementById("exitBtn").onclick = () => {
        window.location.href = "/index4.html";
    };

    /* ================= KH·ªûI ƒê·ªòNG ================= */
    window.onload = () => {
        getRandomQuestions();
    };
</script>


<script src="data.js"></script>


</body>
</html>
